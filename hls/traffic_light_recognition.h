#pragma once

#include <ap_int.h>
#include <hls_stream.h>
#include <ap_axi_sdata.h>
#include <hls_math.h>

#define HEIGHT 128
#define WIDTH 256
#define CHANNEL 3
#define PIXEL_DATA_WIDTH 8
#define DATA_WIDTH_IN 32 //PIXEL_DATA_WIDTH*CHANNEL

typedef ap_axiu<DATA_WIDTH_IN, 1, 1, 1> in_t;
typedef ap_uint<PIXEL_DATA_WIDTH> ap_uint8_t;

struct cond_t {
    unsigned int r;
    unsigned int g;
    unsigned int b;
};

struct Circle {
    int center_x;
    int center_y;
    int radius;
};

template<int height, int width, typename T>
class Image {
public:
    T val[height][width];
    unsigned int rows;
    unsigned int cols;
    Image(unsigned int rows, unsigned int cols) {
        this->rows = rows;
        this->cols = cols;
        for (int i = 0; i < rows; i++) {
            for (int j = 0; j < cols; j++) {
                val[i][j] = 0;
            }
        }
    }
};

void traffic_light_recognition(hls::stream<in_t> &stream_in, unsigned int rows, unsigned int cols, unsigned int radius,
        unsigned int cond_green[3], unsigned int cond_yellow[3], unsigned int cond_red[3], unsigned int *circle_center_x,
        unsigned int *circle_center_y, unsigned int *circle_radius, unsigned int *color);

static float sin_n[180] = { 0.0, 0.01745240643728351, 0.03489949670250097, 0.052335956242943835, 0.0697564737441253, 0.08715574274765817,
        0.10452846326765347, 0.12186934340514748, 0.13917310096006544, 0.15643446504023087, 0.17364817766693033, 0.1908089953765448,
        0.20791169081775934, 0.224951054343865, 0.24192189559966773, 0.25881904510252074, 0.27563735581699916, 0.29237170472273677,
        0.3090169943749474, 0.3255681544571567, 0.3420201433256687, 0.35836794954530027, 0.374606593415912, 0.39073112848927377,
        0.4067366430758002, 0.42261826174069944, 0.4383711467890774, 0.45399049973954675, 0.4694715627858908, 0.48480962024633706,
        0.49999999999999994, 0.5150380749100542, 0.5299192642332049, 0.5446390350150271, 0.5591929034707469, 0.573576436351046,
        0.5877852522924731, 0.6018150231520483, 0.6156614753256583, 0.6293203910498374, 0.6427876096865393, 0.6560590289905073,
        0.6691306063588582, 0.6819983600624985, 0.6946583704589973, 0.7071067811865475, 0.7193398003386511, 0.7313537016191705,
        0.7431448254773942, 0.754709580222772, 0.766044443118978, 0.7771459614569709, 0.788010753606722, 0.7986355100472928,
        0.8090169943749475, 0.8191520442889918, 0.8290375725550417, 0.838670567945424, 0.848048096156426, 0.8571673007021123,
        0.8660254037844386, 0.8746197071393957, 0.8829475928589269, 0.8910065241883678, 0.898794046299167, 0.9063077870366499,
        0.9135454576426009, 0.9205048534524404, 0.9271838545667874, 0.9335804264972017, 0.9396926207859083, 0.9455185755993167,
        0.9510565162951535, 0.9563047559630354, 0.9612616959383189, 0.9659258262890683, 0.9702957262759965, 0.9743700647852352,
        0.9781476007338056, 0.981627183447664, 0.984807753012208, 0.9876883405951378, 0.9902680687415704, 0.992546151641322,
        0.9945218953682733, 0.9961946980917455, 0.9975640502598242, 0.9986295347545738, 0.9993908270190958, 0.9998476951563913, 1.0,
        0.9998476951563913, 0.9993908270190958, 0.9986295347545738, 0.9975640502598242, 0.9961946980917455, 0.9945218953682733,
        0.9925461516413221, 0.9902680687415704, 0.9876883405951378, 0.984807753012208, 0.981627183447664, 0.9781476007338057,
        0.9743700647852352, 0.9702957262759965, 0.9659258262890683, 0.9612616959383189, 0.9563047559630355, 0.9510565162951536,
        0.9455185755993168, 0.9396926207859084, 0.9335804264972017, 0.9271838545667874, 0.9205048534524403, 0.9135454576426009,
        0.90630778703665, 0.8987940462991669, 0.8910065241883679, 0.8829475928589269, 0.8746197071393959, 0.8660254037844387,
        0.8571673007021123, 0.8480480961564261, 0.8386705679454239, 0.8290375725550417, 0.8191520442889917, 0.8090169943749475,
        0.7986355100472927, 0.788010753606722, 0.777145961456971, 0.766044443118978, 0.7547095802227721, 0.7431448254773942,
        0.7313537016191706, 0.7193398003386511, 0.7071067811865476, 0.6946583704589971, 0.6819983600624986, 0.6691306063588583,
        0.6560590289905073, 0.6427876096865395, 0.6293203910498374, 0.6156614753256584, 0.6018150231520482, 0.5877852522924732,
        0.5735764363510459, 0.5591929034707469, 0.5446390350150273, 0.5299192642332049, 0.5150380749100544, 0.49999999999999994,
        0.48480962024633717, 0.4694715627858907, 0.45399049973954686, 0.4383711467890773, 0.4226182617406995, 0.40673664307580043,
        0.39073112848927377, 0.37460659341591224, 0.3583679495453002, 0.3420201433256689, 0.3255681544571566, 0.3090169943749475,
        0.2923717047227366, 0.2756373558169992, 0.258819045102521, 0.24192189559966773, 0.2249510543438652, 0.20791169081775931,
        0.19080899537654497, 0.17364817766693028, 0.15643446504023098, 0.13917310096006533, 0.12186934340514755, 0.10452846326765373,
        0.0871557427476582, 0.06975647374412552, 0.05233595624294381, 0.03489949670250114, 0.01745240643728344 };
static float cos_n[180] = { 1.0, 0.9998476951563913, 0.9993908270190958, 0.9986295347545738, 0.9975640502598242, 0.9961946980917455,
        0.9945218953682733, 0.992546151641322, 0.9902680687415704, 0.9876883405951378, 0.984807753012208, 0.981627183447664,
        0.9781476007338057, 0.9743700647852352, 0.9702957262759965, 0.9659258262890683, 0.9612616959383189, 0.9563047559630354,
        0.9510565162951535, 0.9455185755993168, 0.9396926207859084, 0.9335804264972017, 0.9271838545667874, 0.9205048534524404,
        0.9135454576426009, 0.9063077870366499, 0.898794046299167, 0.8910065241883679, 0.882947592858927, 0.8746197071393957,
        0.8660254037844387, 0.8571673007021123, 0.848048096156426, 0.838670567945424, 0.8290375725550416, 0.8191520442889918,
        0.8090169943749475, 0.7986355100472928, 0.7880107536067219, 0.7771459614569709, 0.766044443118978, 0.754709580222772,
        0.7431448254773942, 0.7313537016191705, 0.7193398003386512, 0.7071067811865476, 0.6946583704589973, 0.6819983600624985,
        0.6691306063588582, 0.6560590289905073, 0.6427876096865394, 0.6293203910498375, 0.6156614753256583, 0.6018150231520484,
        0.5877852522924731, 0.5735764363510462, 0.5591929034707468, 0.5446390350150271, 0.5299192642332049, 0.5150380749100542,
        0.5000000000000001, 0.4848096202463371, 0.46947156278589086, 0.4539904997395468, 0.43837114678907746, 0.42261826174069944,
        0.4067366430758002, 0.3907311284892737, 0.37460659341591196, 0.3583679495453004, 0.3420201433256688, 0.32556815445715676,
        0.30901699437494745, 0.29237170472273677, 0.27563735581699916, 0.25881904510252074, 0.24192189559966767, 0.22495105434386492,
        0.20791169081775945, 0.19080899537654492, 0.17364817766693041, 0.15643446504023092, 0.13917310096006547, 0.12186934340514749,
        0.10452846326765346, 0.08715574274765814, 0.06975647374412523, 0.052335956242943966, 0.03489949670250108, 0.0174524064372836,
        6.123233995736766e-17, -0.017452406437283477, -0.034899496702500955, -0.05233595624294384, -0.06975647374412533,
        -0.08715574274765824, -0.10452846326765355, -0.12186934340514737, -0.13917310096006535, -0.1564344650402308, -0.1736481776669303,
        -0.1908089953765448, -0.20791169081775934, -0.22495105434386503, -0.24192189559966779, -0.25881904510252085, -0.27563735581699905,
        -0.29237170472273666, -0.30901699437494734, -0.32556815445715664, -0.3420201433256687, -0.35836794954530027, -0.37460659341591207,
        -0.39073112848927377, -0.40673664307580026, -0.42261826174069933, -0.4383711467890775, -0.4539904997395467, -0.4694715627858909,
        -0.484809620246337, -0.4999999999999998, -0.5150380749100543, -0.5299192642332048, -0.5446390350150271, -0.5591929034707467,
        -0.5735764363510462, -0.587785252292473, -0.6018150231520484, -0.6156614753256583, -0.6293203910498373, -0.6427876096865394,
        -0.6560590289905072, -0.6691306063588582, -0.6819983600624984, -0.6946583704589974, -0.7071067811865475, -0.7193398003386512,
        -0.7313537016191705, -0.743144825477394, -0.754709580222772, -0.7660444431189779, -0.7771459614569709, -0.7880107536067219,
        -0.7986355100472929, -0.8090169943749473, -0.8191520442889919, -0.8290375725550416, -0.8386705679454239, -0.848048096156426,
        -0.8571673007021122, -0.8660254037844387, -0.8746197071393957, -0.882947592858927, -0.8910065241883678, -0.898794046299167,
        -0.9063077870366499, -0.9135454576426008, -0.9205048534524404, -0.9271838545667873, -0.9335804264972017, -0.9396926207859083,
        -0.9455185755993168, -0.9510565162951535, -0.9563047559630355, -0.9612616959383189, -0.9659258262890682, -0.9702957262759965,
        -0.9743700647852351, -0.9781476007338057, -0.981627183447664, -0.984807753012208, -0.9876883405951377, -0.9902680687415704,
        -0.992546151641322, -0.9945218953682733, -0.9961946980917455, -0.9975640502598242, -0.9986295347545738, -0.9993908270190958,
        -0.9998476951563913 };
